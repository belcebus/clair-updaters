name: updaters generator

on:
  workflow_dispatch:

jobs:
  all:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Export updaters for default sets
        run: |
          docker container run \
          --entrypoint clairctl \
          --name clair \
          --rm \
          --volume ${PWD}/config/config_v4.2.2.yaml:/config/config.yaml:ro \
          --volume ${PWD}/reports:/reports:rw \
          --workdir /run \
          quay.io/projectquay/clair:4.2.2 \
          export-updaters /reports/export-all-updaters
          head ${PWD}/reports/export-all-updaters
          tar cfz ${PWD}/reports/export-all-updaters.tar.gz export-updaters
          
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v2.2.4
        with:
          # Artifact name
          name: updaters
          # A file, directory or wildcard pattern that describes what to upload
          path: ${PWD}/reports/export-all-updaters.tar.gz
